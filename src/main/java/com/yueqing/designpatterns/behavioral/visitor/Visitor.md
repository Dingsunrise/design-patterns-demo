# 访问者模式

## 一 简介

意图
>表示一个作用于某对象结构中的各元素的操作。它使你可以在不改变各元素的类前提下定义作用于这些元素的新操作。
>
访问者模式允许一个或者多个操作应用到一组对象上，设计意图是解耦操作和对象本身，保持类职责单一、满足开闭原则以及应对代码的复杂性。

## 二 适用场景

1. 如果你需要对一个复杂对象结构 （例如对象树） 中的所有元素执行某些操作， 可使用访问者模式。访问者模式通过在访问者对象中为多个目标类提供相同
   操作的变体， 让你能在属于不同类的一组对象上执行同一操作。
2. 可使用访问者模式来清理辅助行为的业务逻辑。该模式会将所有非主要的行为抽取到一组访问者类中， 使得程序的主要类能更专注于主要的工作。
3. 当某个行为仅在类层次结构中的一些类中有意义， 而在其他类中没有意义时， 可使用该模式。你可将该行为抽取到单独的访问者类中， 只需实现接收相关类
   的对象作为参数的访问者方法并将其他方法留空即可。


## 三 实现方式

将一系列元素类的通用行为拆分出去，创建一个通用的访问者接口，在访问者接口中声明一组 “访问” 方法，分别对应程序中的每个具体元素类。然后为不同的
操作创建不同的访问者实现类。
原元素类中实现一个接收方法。这些方法必须将调用重定向到当前元素对应的访问者对象中的访问者方法上。

客户端必须创建访问者对象并通过 “接收” 方法将其传递给元素。

java是单分派语言，所以实现访问者模式会比较复杂。

## 四 优缺点

你可以引入在不同类对象上执行的新行为， 且无需对这些类做出修改。但每次在元素层次结构中添加或移除一个类时， 你都要更新所有的访问者。而且访问者模式
的实现比较复杂，不好理解，一般不建议使用。

## 五 注意事项

访问者模式实现比较复杂，而且操作比较多或者比较复杂时，代码会难以维护，而且每增加一个元素类都需要修改访问者接口，从而需要修改所有访问者实现类，
影响比较大。建议少用。

## 六 应用场景

访问者不是常用的设计模式， 因为它不仅复杂， 应用范围也比较狭窄。
这里是 Java 程序库代码中该模式的一些示例：
javax.lang.model.element.AnnotationValue 和 AnnotationValueVisitor
javax.lang.model.element.Element 和 ElementVisitor
javax.lang.model.type.TypeMirror 和 TypeVisitor
java.nio.file.FileVisitor 和 SimpleFileVisitor
javax.faces.component.visit.VisitContext 和 VisitCallback


### 七 与其他模式关系

**命令模式**
你可以将访问者模式视为命令模式的加强版本， 其对象可对不同类的多种对象执行操作。

**组合模式**
你可以使用访问者对整个组合模式树执行操作。

**迭代器模式**
可以同时使用访问者和迭代器模式来遍历复杂数据结构， 并对其中的元素执行所需操作， 即使这些元素所属的类完全不同。